# 在线 O(1) 求逆元

膜拜 [神 $\scr WaTerC$](https://www.luogu.com.cn/blog/wtcblog/zai-xian-o1-ni-yuan) %%%

众嗦粥之，普通的快速幂/exgcd求逆元方法是 $0-O(\log n)$，而 $\lg(10^9)≈30$ ，相当不小了，然后有的~~毒瘤~~题目会需要 $10^7$ 左右次询问把快速幂卡死。这时就需要$O(p^{2/3})-O(1)$ [在线 O(1) 逆元](https://qoj.ac/problem/5)了。

若求 $x^{-1}\bmod p$。则想办法找到一个 $u:0<u<p$，使得 $xu\bmod p<p^{2/3}$，然后预处理出 $(xu)^{-1}$ 再乘个 $u$ 就行了。

令 $B=\lfloor p^{1/3}\rfloor$，做带余除法 $x=aB+c$，如果令 $u\le p^{1/3}$，那么 $uc<p^{2/3}$，因此需要找到一个对 $u\le p^{1/3},v\le p^{2/3}$，使得 $uaB\equiv v\pmod p$，即 $uaB-v\equiv 0$，容易发现 $u_1aB-v_1\equiv u_2aB-v_2$，那么相减即得到一组解，而 $(u,v)$ 对的数量 $\ge p$，因此一定能得到一组解。