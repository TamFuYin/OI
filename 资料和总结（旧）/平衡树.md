# 平衡树



## BST

BST（Binary Seach Tree,二叉搜索树）是一种神奇的数据结构。

顾名思义，BST首先是二叉树。

而且它满足一个奇妙的性质：左子树内所有节点的权值<父亲的权值<右子树内所有节点的权值。

比方说介样![比方说这样](https://tse1-mm.cn.bing.net/th/id/OIP-C.BIj4F72syuUDfCe3_QIOFwHaER?w=322&h=185&c=7&r=0&o=5&dpr=1.1&pid=1.7)

可以看出，我们可以平均O(log N)实现插入元素、删除元素、查询元素等操作。

然鹅，恶心的出题人可以轻易构造出奇奇怪怪的数据，使得BST退化成一条链，然后时间复杂度就会退化成O(N)。

为了避免这种情况，我们伟大的先人发现了**平！衡！树！**

## Treap

Treap（树堆）是一种简单的平衡树。

顾名思义，它既是Binary Seach Tree，又是Heap。

> heap（小根堆）的性质是父亲的权值<左儿子的权值<右儿子的权值

容易看出这两个性质是矛盾的。

所以我们考虑给每个节点再随机分配一个值。

为了区分，我们约定拥有BST性质的叫权值，拥有Heap性质的叫键值。

键值是随机分配的。

这样一来这棵树就稳定多了。

举个栗子：哪怕出题人再想构造成这样

<img src="C:\Users\tanhj\Desktop\Markdown\Treap1.png" alt="介样" style="zoom: 30%;" />

也可能会变成这样

<img src="C:\Users\tanhj\Desktop\Markdown\Treap2.png" alt="介样" style="zoom: 30%;" />

从而使其“平衡”。

可是问题来了：如何在保持BST性质的情况下使其有Heap性质呢？