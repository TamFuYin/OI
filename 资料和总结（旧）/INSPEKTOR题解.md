题目给出了一些有取值范围一次函数，形如 $y=kx+b(l\le x\le r)$，其中 $k=Z,b=S-ZT,l=T,r=被取代的前一天$。

然后给出区间 $[L,R]$ 和 $T$，问 $\max[i\in[L,R]且l_i\le T\le r_i](k_iT+b_i)$。

一次函数是很复杂的东西，考虑把它转化为点 $(k,b)$，即把 $k$ 作为横坐标，$b$ 作为纵坐标，于是 $b=-xk+y$。

而这个转化后的一次函数的斜率已是确定的了，即询问的 $-T$。而我们要最大化截距，同时要让这个一次函数过点 $(k,b)$（而且 $l\le T\le r$）。

是的，我相信你已经欣喜地喊出来了——这不是斜率优化吗！

然而维护区间 $[L,R]$ 的上凸包绝非易事，尽管存在线性的凸包合并算法，然而常规的线段树却派不上用场，此时莫队将会成为我们的救星。（As usual，预处理出每一块的凸包，整块的二分算切点然后取 $\max$，然后边边角角的地方直接用 $k_iT+b_i$ 暴力即可）

若令块长为$B$，则查询的时间复杂度为 $O(N\log B+M(\frac NB\log B+B))$（前面一部分是预处理$O(B\frac NB\log B)$，后面查询，前一项是整块，后一项是零散）。

至于修改，即删掉一个点、插入一个点，直接 $O(B+\log B)$ 暴力重构即可。（每块用一个`multiset`维护就不用排序了）

尝试利用[费马引理](https://baike.baidu.com/item/费马引理/8693863)算最小值，列偏微分如下
$$
\frac{\mathrm d}{\mathrm dB}(N\log B+MN\frac{\log B}B+MB)=0
$$
导出来介个样子
$$
\frac NB+\frac{MN(1-\log B)}{B^2}+M=0
$$
如果令 $1-\log B$ 为 $-C$ 的话，最终得到
$$
B=\frac{-N+\sqrt{N^2+4CM^2N}}{2M}
$$
时最优（$C$ 大概取 $8$ 左右罢，我也不晓得[对数方程](https://baike.baidu.com/item/对数方程/18894270)怎么解（而且貌似不能用常规方法解））

鄙人初三，微积分是自学的，不甚严谨，如有纰漏请不吝斧正！