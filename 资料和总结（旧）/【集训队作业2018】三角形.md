# 【集训队作业2018】三角形

首先可以发现**某个点放完棋子之后，一定就会立即把它的所有儿子上的棋子拿掉**，因此，可以把每个点表示为二元组 $p=(a,b)$，表示选择这个点会把当前棋子个数 $cur$ 更新为 $cur+a$，并把当前答案 $ans$ 更新为 $\max(ans,cur+b)$，这里 $a_u=w_u-\sum_{v\in \mathrm{son}(u)} w_v$，$b_u=w_u$。

按照 Exchange Argument 的套路，我们发现这个信息是可以合并、比较大小的，这里略去补证。

你发现这道题跟 [Exchange Argument 板子](https://www.luogu.com.cn/problem/AT_agc023_f) 的唯一不同之处在于这道题是**自底向上**操作的，其实有办法把它搞成**自顶向下**操作，那就是把操作颠倒。

想象操作序列排成一条时间线，选择某个点 $u$ 使我们从 $i$ 走到 $i+1$，那么，只要令 $a_u'=-a_u$ 即可从 $i+1$ 走到 $i$ 了，观察操作意义，发现是在 $u$ 的所有儿子上放棋子，然后拿走 $u$ 点上的棋子，然后，显然 $b'_u=\sum_{v\in\mathrm{son}(u)}w_v$。

但是还有一点不同，那就是这道题要求询问所有点的子树答案。

你发现，你想要合并所有儿子的答案，只需要把它摆在最前面，然后对于不同子树内的点按照优先级做一个类似归并排序的东西。仔细思考可以发现，这个跟传统的并查集什么的做法是等价的。~~倒不如说这个才是本质的贪心做法~~

从这个做法可以看出，子树答案一定是总的答案的某个子序列。我们不妨对整棵树做一遍（使用传统的并查集或者链表的算法）即可得到一个离散化的顺序。怎么统计子序列答案和？直接上线段树合并即可。