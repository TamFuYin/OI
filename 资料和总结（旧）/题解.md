有史以来做过（代码+用时）最长的题...~~果然本蒟蒻还是太菜了~~

好了言归正传，既然好不容易做对了就写一下题解吧！

> 每次给定a,b,d~a~,d~b~：
>
> 求树中的一个节点x，使得dis(a,x)=d~a~,dis(b,x)=d~b~，其中dis(u,v)指两点间简单路径的长度。

容易看出来x到a,b的距离合起来就是a到b简单距离（就是a-LCA(a,b)-b这一段，记其长度为len）加上多出来的一段路径，而这段路径的长度即为$\frac{d_a+d_b-len}2$。

于是我们可以求出中转点，然后求出这个中转点不经a-LCA(a,b)-b的最远点，然后在中转点到它的最远点的路径上的第$\frac{d_a+d_b-len}2$个点即为所求。

题解使用的是树形DP，但是我太蒟了，担心树形DP会打错，所以使用线段树离线维护一个点到其他点的距离（的(DFS序的)区间最大值，因为后面要求最远点），具体实现是在u转移到v时，v的子树中的距离自减1，其他自增1。

因为这个中转点有可能在a-LCA(a,b)上，也可能在b-LCA(a,b)上，甚至可能在a或者b或者LCA(a,b)上，于是我们分类讨论一波。自己画图自己推，算出来中转点所有的可以取的不经过a-LCA(a,b)-b而能到达的点的(DFS序上的)区s间（当然会有多个区间），然后扔给我们的离线处理求最大值及其所在，所在即为x。

求中转点和答案x也分类讨论一波，搞出来LCA然后看一下在哪边，然后倍增往上跳父亲。

时间/空间复杂度$O(n\log n)$