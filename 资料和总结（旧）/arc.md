合法当且仅当 $a,b,c$ 奇偶性相同。

然后就可以 DP 了。

先预处理 $f_{l,r}$ 表示使 $s[l,r]$ 为好串的方案数。

设 $g_{i,j}$ 表示当前操作到第 $i$ 位，有 $j$ 个好串的方案数。