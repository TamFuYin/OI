# 中国剩余定理

## exCRT

$$
\begin{equation}
\left\{
\begin{aligned}
x\equiv a_1\pmod{p_1}\\
x\equiv a_2\pmod{p_2}\\
\end{aligned}
\right.
\end{equation}
$$

拆同余
$$
\begin{equation}
\left\{
\begin{aligned}
x-a_1=p_1*t_1\\
x-a_2=p_2*t_2\\
\end{aligned}
\right.
\end{equation}
$$
有
$$
x=a_1+p_1*t_1=a_2+p_2*t_2
$$
得到不定方程
$$
p_1*t_1-p_2*t_2=a_2-a_1
$$
拓欧解出一组可行解$t_1,t_2$

合并为$x\equiv a_1+p_1*t_1\pmod{lcm(p_1,p_2)}$

# 中国剩余定理

[NOI2018 屠龙勇士](https://www.luogu.com.cn/problem/P4774)
$$
\begin{equation}
\left\{
\begin{aligned}
x\cdot ATK_1\equiv a_1\pmod{p_1}\\
x\cdot ATK_2\equiv a_2\pmod{p_2}\\
\vdots\\
x\cdot ATK_n\equiv a_n\pmod{p_n}
\end{aligned}
\right.
\end{equation}
$$
乖乖，带系数的中国剩余定理。

逆元？抱歉，他可没说ATK和p互质，不一定有逆元。

如果我们算出了前i-1的答案为ans，即求
$$
设lcm=\operatorname{lcm_{1\le k\le i-1}}p_k\\
\begin{equation}
\left\{
\begin{aligned}
x \equiv ans\pmod{lcm}\\
x\cdot ATK_i\equiv a_i\pmod{p_i}\\
\end{aligned}
\right.
\end{equation}
$$
遇事不决拆同余
$$
\begin{equation}
\left\{
\begin{aligned}
x-ans=lcm\cdot k_1\\
x\cdot ATK_i-a_i= p_i*k_2\\
\end{aligned}
\right.
\end{equation}
$$
代进②里：
$$
(ans+lcm\cdot k_1)\cdot ATK_i-a_i=p_i*k_2
$$
化简：
$$
lcm\cdot ATK_i\cdot k_1-p_i\cdot k_2=a_i-ans\cdot ATK_i
$$
这个式子一看就是老拓欧了。计算exgcd(lcm*ATK~i~,-p~i~)，获得k~1~和k~2~

最终$x\equiv ans+lcm\cdot k_1\pmod{\operatorname{lcm}(lcm,p_i)}$

## 私の拓展中国剩余定理

$$
\begin{equation}
\left\{
\begin{aligned}
b_1x\equiv a_1\pmod{p_1}\\
b_2x\equiv a_2\pmod{p_2}\\
\end{aligned}
\right.
\end{equation}
$$

