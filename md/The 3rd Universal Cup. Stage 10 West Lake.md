# The 3rd Universal Cup. Stage 10: West Lake

## Italian Cuisine

不做

## Generated String

考虑找出所有出现的串，离线造一个数据结构，然后动态插入查询即可。

我们想要知道目前 $\mathbb A$ 中所有串与询问串的 LCP 和 LCS 信息，不妨维护一个前缀 Trie 和后缀 Trie，并得到每个串的 DFS 序，则问题转化为动态二维数点，即「三维偏序」，CDQ 解决即可。

但是问题在于我们不可能显式的建出所有串，而且 Trie 的大小过大。

考虑用类似「后缀树」的技巧，得到一个压缩 Trie，即缩掉所有的二度点。

那么我们在压缩 Trie 上，维护一个所有串的 LCP，然后进入不同分支。

考虑用一个多指针(?)状物维护当前这个东西匹配到哪个地方。

具体地，考虑固定一个串，然后查询其他串剩余未匹配部分与其的 LCP，如果找到 LCP=0 的串，就需要新开一个<ruby>分支<rt>兄弟</rt></ruby>。

在 $S$ 上建一个 SA+ST 辅助完成 LCP 查询即可。

## Permutation

考虑左边全部填 $1$，右边全部填 $2$。

如果答案是 $0$ 或者 $2$，那么很好。

否则，我们知道 $1$ 和 $2$ 在同一个区间内。貌似做不了。

注意到交互器是非适应性的，所以考虑随机化。

每次随两个数 $x$ 和 $y$，则在同一个区间的概率为 $1/2$。

这样就做完了。

## Collect the Coins

考虑二分答案，则可以线性 check。

注意到两个机器人在任意时刻的可能的位置集合都形如一段区间。

## Normal Friends

区间 $[1,x]$ 的翻转操作，等价于找到第 $x$ 个叶子，然后对 $x$ 到根的路径上所有点的左子树整体翻转，且内部翻转。

考虑用 LCT 维护，则只要 access 之后对其左儿子列表翻转即可。

果然还是太有难度了。

## Triangle

设 $(x,y,z)$ 中字典序最大的为 $x$，则 $xy>z$ 和 $xz>y$ 一定成立，如果 $yz>x$，显然这需要 $y$ 为 $x$ 的前缀且 $z>y^{-1}x$。

不妨令 $yz>zy$，这等价于 $y^*>z^*$，所以可以按照 $s_i^*$ 排序。

怎么排呢？考虑先判断两个串是否为前缀关系，否则可以用 SA 求 LCP 后比较，这样比较的复杂的就是 $O(\min(|y|,|z|))$，允许 sort。

然后就变成二维偏序。

## Stop the Castle 2

转化为选 $m-k$ 个障碍物，隔开尽可能多的车。

考虑把一对相邻的车看作一个元素，那么一个障碍物可以覆盖最多两个点，因此不妨把它看作一条边，则转化为最小点覆盖问题。特别地，如果只覆盖一个点，可以新建一个点然后连一下。

注意到我们可以把横着摆的一对车和纵着摆的一对车分开，于是形如二分图最小点覆盖。这样就做完了

## Intersection of Paths

显然交集也是一条路径，合法当且仅当两边挂的子树大小 $\ge k$。

~~考虑从小到大增大 $k$，那么我们每次会拔掉一些不满足条件的点。~~

考虑一个边是合法的，如果它较小的一边的子树大小 $\ge k$。

考虑从大到小减少 $k$，则我们每次会加入一些边，且总是形如一个连通块。

如果不考虑修改，那么我们可以动态维护这个连通块的直径。

否则，我们需要考虑求出经过它/不经过它的最优解。

在树剖线段树上搞一搞，可以做出来

## Find Yourself

注意到树总是合法的。

考虑对树黑白染色，那么可以确定怪物所在点的颜色，不妨假设与根相同。

假设已知怪物在 $x$ 子树内，且颜色与 $x$ 相同。如何确定其在哪棵子树内？

1. 询问 $x$，如果怪物在 $x$，则直接结束
2. 否则，此时怪物走到了 $x$ 中与 $x$ 颜色不同的点。
3. 询问一棵子树，如果问到了就直接进去即可，否则可以删掉这棵子树继续搞。

但是这个条件肯定不是充要的，因为样例给出了一个合法的四元环。

为什么是合法的？假设环编号为 $(1,2,3,4)$，我们询问 $\{1,3\}$，即可知道怪兽的颜色，不妨假设颜色为奇数。那么我们下一次再问一下 $2$ 即可。

实际上，我们能够合法是因为 $n$ 是偶数且 $n/2=2$，所以才能区分所有的位置。所以在所有的环图中只有四元环是合法的。

考虑四元环连上一些别的点是否合法。

可以发现，能确定的图的每个点双都只能是四元环，且四元环不能有两个点都连有长度为 $2$ 的链，也不能四个点都和其他点有边。

## Sheriruth

注意到一个点的所有出点会形成一个团，可以考虑用并查集维护这个，每个团缩成一个点。

考虑缩完之后的图，可以看作只有一个出点，所以形成一个内向基环树森林。

每个团的贡献为 $\sum_{i=0}^{c-2}(c-2)^{\underline i}$。

## Palindromic Polygon

$n$ 比较小，考虑用类似三角剖分的方式复制一份做区间 DP。

考虑每次找到 $f_l=f_r$ 的位置，然后从 $l<i\le j<r$ 转移过来，可以做到 $O(n^4)$。

注意到如果 $(l,i)$ 和 $(j,r)$ 中如果都有 $=f_i$ 的点，那么把它选上一定不会更劣。

那么有用点对为 $i$ 是 $(l,r)$ 中第一个等于 $f_i$ 的点，或者 $j$ 是 $(l,r)$ 中最后一个等于 $f_i$ 的点。

所以总共有 $O(n)$ 个转移，可以做到 $O(n^3)$。

## Cosmic Travel

考虑对于区间查询用类似线段树分治的方式做，那么我们只需要考虑整区间，即固定一段前缀，对于所有后缀的答案之和。

不妨对 $a$ 建 Trie，然后我们可以找到对于这段异或的前缀而言最小的子树，如果子树内元素数量 $\ge k$，可以预处理这个答案，否则 $k\gets k-$ 子树内元素数量，然后找到第二小的子树，依次类推。

预处理是不难的，可以均摊分析出时间复杂度为 $O(n\log V)$。

## The Quest for El Dorado

如果保证 $a_i$ 互不相同，那可以用简单的分层图最短路解决。

但是这里不行，因为状态数过多了。

考虑把状态定义到「距离」里，然后就是对的，每次松弛需要找到某个点后面第一个这个颜色，可以用线段树二分搞一下。