# EI 之「忘丘」

板子合集

## 彩色弹珠

扫描线

## 狗

考虑对于每种 $x$ 维护一个 ODT，那么查询时需要查询所有「被完全包含」的颜色的数量。

如果每种颜色只有一个区间，那么问题形如二维数点。

注意到每个区间最多被一个区间完全包含，所以把不同区间看作不同颜色是对的。

然后问题就是动态二维数点，可以两只 log 做完。

## 梨

发现问题形如二分图匹配。

直接线段树辅助建边跑网络流即可。

## 锅

根号重构。

## 树状数组

求两个数的二进制位下 LCP 即可

## 精灵之环

一个置换复合 $k$ 次，会把长度为 $m$ 的环拆成 $\gcd(m,k)$ 个环，每个环的长度为 $m/\gcd(m,k)$。

因此合法当且仅当每个环 $\gcd(m',k)=1$。剩下不难构造。

## 道路规划

矩阵树定理。

也可以用 Berlekamp-Massey。

## 空间切割

EI 是不会用 `\bm` 吗……

## 御坂网络

每个 $w_i$ 的贡献系数是 $(\sum s_j(s_i-s_j)+s_i+1)/2$，其中 $j$ 对 $i$ 的所有儿子求和。

所以可以换根 DP，每次只改两个点。

## 传送门

我已经是第三次见到这道题了……

其实可以做到 $n,m\le 10^5$

## 游戏

拆贡献的话，不难算出从 $x$ 到每个点的路径条数。

## 组合数

差分之后，我们想要计算的实际上是

$$
\sum_{i=0}^n\sum_{j=0}^m\binom ij
$$

行内二项式系数和是困难的，但是列内却是简单的。

## 瘟疫公司

注意到我们可以 $\tilde O(2^nm)$ 算出 $w$，枚举集合大小之后每次用形如子集卷积的技巧计算即可做到 $O(2^nn^2)$。

## 彼岸蔷薇

树上 DP。

## 复读 / 复读机

考虑枚举第一周期结束后到达的点 $u$。

## 混乱度

考虑 Lucas 定理，把每个 $a_i$ 表示为 $p$ 进制，那么

$$
f(l,r)=\prod_e[a_l^{(e)}+\dots+a_r^{(e)}<p]\frac{(a_l^{(e)}+\dots+a_r^{(e)})!}{a_l^{(e)}!\cdots a_r^{(e)}!}\pmod p
$$

对于一个 $l$，只有 $O(p)$ 个 $r$ 使答案不同。

## 极地科考

注意到长度 $\ge 2k$ 的区间是无用的，因为取较大的一半即可。

## 梦中的项链

对「相同的相邻位置」容斥，记 $f=\sum_{k,l}a_k(-1)^{l-1}x^{kl}$，则答案即为 $xf'/(1-f)$。

## 押韵

答案
$$
\sum_{d|a_i}[\prod x_i^{a_i}](\sum x_i)^{nd}
$$

考虑单位根反演。

$$
[m|k]=\frac{1}{m}\sum_{i=0}^{m-1}\omega_{m}^{ik}
$$

所以答案为

$$
\frac{1}{d^k}\sum_{0\le i_j<d}(\sum \omega_{d}^{i_j})^{nd}
$$

## 观察星象

注意到至少有三个点在圆环上，如果只有两个点，那么一定是对踵的。

## 斑斓星

每次删掉度数最小的点。

## 彩绘

显然三维是互相独立的。

考虑一个点的贡献，设左边有 $l$ 个元素，$r$，则 $\frac{(2l-1)!!(2r-1)!!}{2^{l+r}l!r!}$

## 旅行诗

## 马克思么克斯

注意到仅有 $O(n)$ 对 $(l_0,r_0,l_1,r_1,b)$ 使所有 $l_0\le l\le l_1,r_0\le r\le r_1$ 都有 $\operatorname{mex}(a_l,a_{l+1},\dots,a_r)=b$，覆盖所有 $1\le l\le r\le n$。

我称之为区间 mex 基本结构。不难用扫描线+可删堆求出来。

然后就做完了。

## 么克斯马克思

建笛卡尔树，然后相当于对一段前缀的答案插入元素，从小到大扫，只关注不存在的最小元素即可。

## 萌二

记 $S=\sum_{i\in \mathcal S}x^i$，则 $F(z)=S(1+F(z)+\frac{F(z)^2+F(z^2)}{2})$

可以用类似多项式牛顿迭代法的方式求出来。

## 生活在树上

只要保证每次都使 $\sum \operatorname{dist}(i,p_i)$ 减少 $2$ 即可，即保证每次两个交换的元素都在其路径上。

注意到每个点恰有一条边使其合法，我们随便维护一下即可。